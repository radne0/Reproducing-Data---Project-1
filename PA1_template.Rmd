---
title: "Reproducible Data - Project"
author: "Jason"
date: "2024-02-14"
output: 
  html_document: 
    keep_md: true
---

<!-- make sure code and output is echoed. adjust scientific notation -->
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE,options(scipen=10))
```

### Examining and Understanding the dataset.

Examining the provided data set, it is apparent that the data is comma separated and
contains headers. Within the dataset there are 17568 observations, each spanning over 3 columns. For each column, the following data types and observations are inferred:

* ***steps:*** numeric/integer.  This is the number of steps taken in a particular five minute time interval.  NA values are present in the data. The source of these is unknown but a logical assumption is either a data recording error occurred or that there were 0 steps taken in that period.  The presence of 0s elsewhere in the data indicate that the former is more likely.  The frequency and impact of these NAs will be explored further in the coming analysis. 

* ***date:*** Date. Date,in YYYY-MMM-DD format, for which the data was recorded. 61 unique values ranging from Oct 1, 2012 to Nov 30, 2012 are present, covering each day of the 2 month period of interest.

* ***interval***: numeric/integer.  Identifies which 5 minute interval the data was measured. 288 unique values ranging from 0 to 2355.

### Loading the dataset.###

With the file format and data types determined, we begin importing the data.
```{r read files}
act_data <- read.csv('data/activity.csv', colClasses = c('numeric', 'Date', 'numeric'))
```

### Examining the number of daily steps.
We begin our analysis by examining some of the statistics (mean, median) related to the total number of steps taken on a daily basis.  To gain an understanding of the distribution of these total number of steps, we compute the total number of steps taken for each day and plot the cooresponding histogram.

```{r histogram}
daily_steps<- tapply(act_data$steps,act_data$date,sum,na.rm=TRUE)
hist(daily_steps,col="blue",main="Daily step distribution",xlab ="steps")
```

From our daily steps, we look compute a few key measures of central tendency, the mean and the median.

```{r central tendencies}
daily_mean <- mean(daily_steps)
daily_median <- median(daily_steps)
print(daily_mean)
print(daily_median)
summary(daily_steps)
```

From the analysis, we observe that the mean of the total daily steps is `r daily_mean`, while the median of this data is `r daily_median`.  Also we see that there were a minimum of `r min(daily_steps)` steps taken and a maximum of `r max(daily_steps)` taken over the course of the two month period. 

### Examining steps by the interval.

Next, we shift our focus to exploring the activity data over each interval.  For each interval we obtain the mean steps over the entire two month period. 

```{r time series plot}
five_min <- tapply(act_data$steps,act_data$interval,mean,na.rm=TRUE)
five_min_mean <- mean(five_min)
five_min_max <- max(five_min)
intervals <- unique(act_data$interval)
max_int <- intervals[ five_min == five_min_max ]
print(five_min_max)
print(max_int)
```

reveals that the maximum average number of steps is `r five_min_max` and occurs at `r max_int` minutes into the observation period.  We summarize this data in the below time series plot (The mean of the time series data is shown for reference).

```{r time series}
plot(intervals,five_min,type='l',col="red",main = "Average steps by interval",
     xlab="interval", ylab="Average number of steps",xlim=c(0,2400),xaxt='n')
abline(h=five_min_mean,lty=2)
arrows(250,150,0,mean(five_min))
text(250,160,paste("overall mean: ",as.character(round(five_min_mean,2))))
arrows(1500,five_min_max-50,max_int,five_min_max)
text(1800,five_min_max-50, paste0("(",as.character(max_int),",",as.character(round(five_min_max,3)),")")   )
axis(1,at=seq(0,2400,300))
```


### A look at the missing data from our dataset.

Inspection of the data reveals that there are numerous rows in which the step count is NA.  In particular,

```{r NA values count}
na_count <- sum( is.na(act_data))
apply(is.na(act_data),2,sum) 
```
there are `r na_count` NA values which occur completely within the step count column.  We examine further to determine where these NA values are located in the dataset.

```{R NAs grouped by interval and day}
na_by_interval <- tapply(is.na(act_data$steps),act_data$interval,sum)
na_by_dates <- tapply(is.na(act_data$steps),act_data$date,sum)
na_by_interval[na_by_interval > 0]
na_days<- na_by_dates[na_by_dates > 0]
print(na_days)
weekdays(as.Date(rownames(na_days)))
```
This reveals that there are precisely 8 NA values for each and every interval.  By days, we observe that these NA values are restricted to 8 days in particular, with no notable distribution across the days of the week.  With respect to the steps column these values make up `r round(na_count / nrow(act_data) *100,3)`% of the observations.

### Filling in the missing values.
Since the the presence of these NA values may introduce bias and volatility to our mean and median calcuations, we seek to fill in these values in a reasonable manner. For this analysis, we choose to replace NA values with the mean number of steps for the interval in which the NA resides.  We form the a new dataset accordingly

```{r removeNAs}
na_location <- is.na(act_data$steps)
act_data_noNA <-  act_data
act_data_noNA[na_location,1] <- five_min[as.character(act_data[na_location,3])]
```

With the dataset cleaned up and the NA values replaced we revisit the daily step plot to examine the impact of the NA values


```{r histogram with no NA}
daily_steps_noNA<- tapply(act_data_noNA$steps,act_data_noNA$date,sum,na.rm=TRUE)
hist(daily_steps_noNA,col="blue",main="Daily step distribution",xlab ="steps")
```

We again compute the mean and the median

```{r central tendencies with NA remove}
daily_mean_noNA <- mean(daily_steps_noNA)
daily_median_noNA <- median(daily_steps_noNA)
print(daily_mean_noNA)
print(daily_median_noNA)
summary(daily_steps_noNA)
# %increase in mean / median
mean_i <- round( (daily_mean_noNA-daily_mean)/daily_mean*100, digits=2)
median_i <- round( (daily_median_noNA-daily_median)/daily_median*100, digits=2)  
```

For comparison, we show both plots side by side on the same scale.
```{r histogram with and without NA}
par(mfrow=c(1,2))
hist(daily_steps,col="blue",main="With NA values",ylim=c(0,40),xlab="steps")
hist(daily_steps_noNA,col="blue",main="Without NA values",ylim=c(0,40),xlab="steps")
```

This demonstrates the impact of the NA values on the distribution.  With replacement, we see a drop in frequency on the lower end due the 8 days that had no data now having data based on the interval averages.  This drives an overall increase in the mean and the median of our data and results in a distribution that is more centrally distributed.  In particular, we observe a `r mean_i`%
increase in the mean and a `r median_i`% increase in the median

### Weekday vs Weekend steps.

Next we consider the steps over the weekdays  vs the steps taken over the weekend.  To accomplish these we add a column which designates each date as either a weekday (Mon-Fri) or a weekend (Sat-Sun).  We plot the interval averages over these factors.


```{r weekend vs weekday}
library(dplyr)
library(ggplot2)
act_data_noNA<- transform(act_data_noNA,
    day_type= factor(ifelse(weekdays(act_data_noNA$date) %in%  c("Saturday","Sunday"),"weekend","weekday")))

act_data_noNA %>%
    group_by(interval,day_type) %>%
    summarize(m = mean(steps)) %>%
    ggplot( aes(x=interval, y=m) ) +
        geom_line( aes(col=day_type)) + 
        facet_grid(day_type ~.) + 
        ylab("Mean number of steps") + 
        theme(legend.position="none")
```


```{r echo=FALSE}
#weekday_data <- subset(act_data_noNA, day_type == "weekday"   ) 
#weekend_data <- subset(act_data_noNA, day_type == "weekend")
#five_min_wd <- tapply(weekday_data$steps,weekday_data$interval,mean,na.rm=TRUE)
#five_min_we <- tapply(weekend_data$steps,weekend_data$interval,mean,na.rm=TRUE)
```







